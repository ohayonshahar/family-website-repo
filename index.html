<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>האתר המשפחתי שלי</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #282c34;
        color: #e0e0e0;
        margin: 0;
        padding: 0;
        line-height: 1.6;
        direction: rtl; /* לכיוון מימין לשמאל */
        text-align: right; /* יישור לימין */
    }

    header {
        background-color: #20232a;
        color: #61dafb;
        padding: 15px 0;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        position: relative;
    }

    header h1 {
        margin: 0;
        font-size: 2.5em;
    }

    .menu-toggle {
        display: none; /* נסתר כברירת מחדל */
        cursor: pointer;
        font-size: 2em;
        padding: 10px 20px;
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: #61dafb;
    }

    nav {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-top: 10px;
    }

    nav a {
        color: #61dafb;
        text-decoration: none;
        font-weight: bold;
        padding: 8px 15px;
        transition: color 0.3s ease, background-color 0.3s ease;
        border-radius: 5px;
    }

    nav a:hover {
        color: #282c34;
        background-color: #61dafb;
    }

    .content-box {
        background-color: rgba(40, 44, 52, 0.9);
        margin: 30px auto;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.5);
        max-width: 800px;
        text-align: center;
        border: 1px solid #444;
    }

    .content-box h1 {
        color: #61dafb;
        font-size: 2.8em;
        margin-bottom: 15px;
    }

    .content-box p {
        font-size: 1.1em;
        color: #f0f0f0;
        margin-bottom: 15px;
    }

    .circular-image {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #61dafb;
        margin-bottom: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .share-button {
        display: inline-block;
        background-color: #25D366; /* WhatsApp green */
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 20px;
    }

    .share-button:hover {
        background-color: #1DA851;
        transform: translateY(-2px);
    }

    .content-box h2 {
        color: #61dafb;
        font-size: 2.2em;
        margin-top: 30px;
        margin-bottom: 20px;
    }

    .content-box ul {
        list-style: none;
        padding: 0;
    }

    .content-box ul li {
        background-color: #3a3f47;
        margin-bottom: 10px;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #555;
        font-size: 1.05em;
        color: #e0e0e0;
    }

    .content-box ul li strong {
        color: #f7b32b;
    }

    .content-box a {
        color: #61dafb;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .content-box a:hover {
        color: #4fa3d1;
        text-decoration: underline;
    }

    footer {
        text-align: center;
        padding: 20px;
        margin-top: 40px;
        background-color: #20232a;
        color: #aaa;
        font-size: 0.9em;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.4);
    }

    /* AI Chatbot specific styles */
    .ai-chat-container {
        background-color: rgba(40, 44, 52, 0.9);
        margin: 50px auto;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.5);
        max-width: 600px;
        text-align: right; /* Changed to right for RTL */
        border: 1px solid #444;
    }
    .ai-chat-container h2 {
        color: #61dafb;
        text-align: center;
        margin-bottom: 25px;
        font-size: 2em;
    }
    .chat-output {
        height: 250px;
        overflow-y: auto;
        border: 1px solid #555;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #333;
        border-radius: 8px;
        color: #f0f0f0;
        scroll-behavior: smooth;
    }
    .chat-output p {
        margin: 5px 0;
        word-wrap: break-word;
        text-align: right; /* Ensure text alignment is right for chat */
    }
    .chat-output strong {
        color: #f7b32b;
    }
    .chat-input-area {
        display: flex;
        gap: 10px;
        flex-direction: row-reverse; /* For RTL input flow */
    }
    #userInput {
        flex-grow: 1;
        padding: 12px;
        border: 1px solid #555;
        border-radius: 8px;
        background-color: #3a3f47;
        color: #e0e0e0;
        font-size: 1em;
        outline: none;
        text-align: right; /* Ensure input text is right-aligned */
    }
    #userInput::placeholder {
        color: #aaa;
    }
    .ai-chat-container button {
        padding: 12px 25px;
        background-color: #61dafb;
        color: #282c34;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .ai-chat-container button:hover {
        background-color: #4fa3d1;
        transform: translateY(-2px);
    }
    @media (max-width: 768px) {
        .ai-chat-container {
            margin: 30px auto;
            padding: 20px;
        }
        .chat-input-area {
            flex-direction: column;
        }
        #userInput, .ai-chat-container button {
            width: 100%;
            box-sizing: border-box;
        }
    }

    /* Responsive navigation for mobile */
    @media (max-width: 768px) {
        nav {
            flex-direction: column;
            display: none; /* Hide by default on small screens */
            width: 100%;
            background-color: #20232a;
            position: absolute;
            top: 100%; /* Position below the header */
            left: 0;
            z-index: 1000;
        }
        nav.show {
            display: flex; /* Show when 'show' class is added */
        }
        nav a {
            text-align: center;
            padding: 15px;
            border-bottom: 1px solid #333;
        }
        nav a:last-child {
            border-bottom: none;
        }
        .menu-toggle {
            display: block; /* Show menu toggle on small screens */
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-right: 20px; /* Adjust padding due to menu toggle */
        }
        header h1 {
            flex-grow: 1; /* Allow h1 to take available space */
            text-align: center;
        }
    }
    </style>



    <script>
        function toggleMenu() {
            const nav = document.getElementById("navMenu");
            nav.classList.toggle("show");
        }

        function shareToWhatsApp() {
            const url = window.location.href;
            const text = "היי! תראה את האתר המשפחתי שלנו: " + url;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(whatsappUrl, '_blank');
        }
    </script>
</head>

<body>
    <header>
        <div class="menu-toggle" onclick="toggleMenu()">☰</div>
        <h1>האתר המשפחתי שלי</h1>
        <nav id="navMenu">
            <a href="/">דף הבית</a>
            <a href="/public_media/">תמונות ציבוריות</a>
            <a href="/private_media/">סרטונים פרטיים</a>
            <a href="/portfolio/">הפורטפוליו שלי</a>
        </nav>
    </header>

    <div class="content-box">
        <img src="/public_media/images/your_profile_image.jpg" alt="תמונת פרופיל משפחתית" class="circular-image">
        <h1>ברוכים הבאים לאתר המשפחתי!</h1>
        <p>כאן תוכלו למצוא תמונות, סרטונים וזיכרונות משותפים.</p>
        <p>אנו מתרגשים לשתף אתכם את הרגעים המיוחדים שלנו.</p>
       
        <a href="#" class="share-button" onclick="shareToWhatsApp()">שתף בוואטסאפ</a>
    </div>

    <div class="ai-chat-container">
        <h2>שאל את משפחת אוחיון (AI)</h2>
        <div id="chatOutput" class="chat-output"></div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="שאל שאלה על המשפחה...">
            <button onclick="sendMessageToAI()">שלח</button>
        </div>
    </div>



    <div class="content-box">
        <h2>לינקים שימושיים:</h2>
        <p><a href="/public_media/">גלריית תמונות ציבורית</a></p>
        <p><a href="/private_media/">סרטונים פרטיים (נדרשת סיסמה)</a></p>
        <p><a href="/private_files/">קבצים פרטיים (WebDAV, נדרשת סיסמה)</a></p>
        <p><a href="/portfolio/">הפורטפוליו שלי (דרך NFS)</a></p>
    </div>

    <footer>
        <p>&copy; 2025 משפחת אוחיון. כל הזכויות שמורות.</p>
    </footer>

    <script>
        // **החלף כאן את ה-API_KEY במפתח ה-API החדש שלך**
        const API_KEY = "AIzaSyDV7gMYxRaaSrOnu7MISdIExtHfSZj4yOE"; 
        const GEMINI_MODEL = "gemini-1.5-pro-latest";

        async function sendMessageToAI() {
            const userInputField = document.getElementById('userInput');
            const chatOutput = document.getElementById('chatOutput');
            const userInput = userInputField.value.trim();

            if (!userInput) return;

            // הוספת הודעת המשתמש לתצוגה
            chatOutput.innerHTML += `<p><strong>אתה:</strong> ${userInput}</p>`;
            userInputField.value = '';
            userInputField.disabled = true;
            chatOutput.scrollTop = chatOutput.scrollHeight;

            try {
                // הנחיית מערכת (System Prompt) משולבת עם קלט המשתמש
                const systemPrompt = `
אתה צ'אטבוט של אתר משפחת אוחיון. ענה על שאלות אך ורק בהתבסס על המידע המפורט להלן. אם מידע מסוים אינו מופיע כאן, אנא אמור ש"אין לי מידע בנושא זה". השב בעברית, בשפה ידידותית ומכבדת.

מידע על משפחת אוחיון הגרעינית:
- ההורים: מיכאל ורחל אוחיון.
- ילדיהם (לפי סדר לידה):
    - איילת: נקבה. יש לה ילדה אחת בשם איטל.
    - שני: נקבה, תאריך לידה 12/07/1978. נשואה לנחום, ויש להם ילדה אחת בשם אושר איטה.
    - שחר: זכר, תאריך לידה 24/12/1979. גרוש עם שני ילדים: איתי והילי.
    - שירי: נקבה. נשואה לחיים קוליקר. יש להם 4 בנות: אופל, שוהם, קורל, וטוהר רומי.
    - סער: זכר. נשוי לדמה, ללא ילדים.
    - איתי אוחיון: 03/05/2016; הבן של שחר אוחיון; דינוזאורים, פוקימון, חקירות, מיינקראפט, פורטנייט; משפחה; טלפון
    - הילי אוחיון; 15/11/2017; הבת של שחר אוחיון; קובה סלק; לילו וסטיץ'; לבן; ג'ונו (חבר דמיוני)


`;
                
                // שלב את הנחיית המערכת וקלט המשתמש כחלק מאותה הודעת "user"
                const combinedInput = systemPrompt + "\n\n" + userInput;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                // חשוב: כל אובייקט תוכן חייב לכלול 'role'
                                role: "user", 
                                parts: [{ text: combinedInput }] 
                            }
                        ],
                        safetySettings: [
                            // הגדרות אלה קריטיות ומונעות חסימת תגובות על ידי המודל.
                            // BLOCK_NONE מאפשר את המקסימום, שים לב לשיקולי אבטחה ביישום אמיתי.
                            { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
                            { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
                            { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
                            { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' },
                        ],
                        // ניתן להוסיף גם generationConfig אם רוצים לשלוט על הטמפרטורה, topP, topK וכו'.
                        // לדוגמה:
                        // generationConfig: {
                        //   temperature: 0.9,
                        //   topP: 1,
                        //   topK: 1
                        // }
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`שגיאת API: ${response.status} - ${errorData.error.message || 'unknown error'}`);
                }

                const data = await response.json();

                let aiResponseText = "מצטער, לא הצלחתי לעבד את הבקשה. ייתכן שיש בעיה זמנית.";
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                    aiResponseText = data.candidates[0].content.parts[0].text;
                } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                    // אם הבקשה נחסמה על ידי מדיניות הבטיחות של גוגל
                    aiResponseText = "מצטער, הבקשה שלך נחסמה בגלל מדיניות הבטיחות.";
                    if (data.promptFeedback.blockReason === 'SAFETY') {
                        // ניתן להוסיף כאן לוגיקה נוספת להצגת הסיבה הספציפית
                        console.warn('Blocked by safety settings:', data.promptFeedback.safetyRatings);
                    }
                } else {
                    console.warn('Unexpected API response structure:', data);
                    aiResponseText = "מצטער, קיבלתי תשובה לא צפויה מה-AI.";
                }

                chatOutput.innerHTML += `<p><strong>AI:</strong> ${aiResponseText}</p>`;

            } catch (error) {
                console.error("שגיאה בתקשורת עם ה-AI:", error);
                chatOutput.innerHTML += `<p><strong>AI:</strong> מצטער, אירעה שגיאה: ${error.message}. אנא נסה שוב.</p>`;
            } finally {
                userInputField.disabled = false;
                userInputField.focus();
                chatOutput.scrollTop = chatOutput.scrollHeight;
            }
        }

        document.getElementById('userInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessageToAI();
            }
        });
    </script>
</body>
</html>
